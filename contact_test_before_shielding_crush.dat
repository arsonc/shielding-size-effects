def contact_test_before_shielding_crush

wall_num_bottom=find_wall(1)
wall_num_top=find_wall(2)
bottomdis_5=0.0
topdis_6=0.0
contact_vel=5e-7

loop m (1,100000);maxium step is 1e5

	wall_numwp=wall_head

	loop while wall_numwp # null
		
		wall_forcewp=sqrt(w_xfob(wall_numwp)^2+w_yfob(wall_numwp)^2+w_zfob(wall_numwp)^2);get the unballenced force
		
		if wall_forcewp>5e4
		
			w_vvel(wall_numwp,1)=0.0;speed of the wall
			w_vvel(wall_numwp,2)=0.0
			w_vvel(wall_numwp,3)=0.0
		end_if
		
		
		wall_numwp=w_next(wall_numwp)
	end_loop

command
	
	cycle 1
end_command



wall_vel_bottom=sqrt(w_xvel(wall_num_bottom)^2+w_yvel(wall_num_bottom)^2+w_zvel(wall_num_bottom)^2)
bottomdis_5=bottomdis_5+wall_vel_bottom*1

wall_vel_top=sqrt(w_xvel(wall_num_top)^2+w_yvel(wall_num_top)^2+w_zvel(wall_num_top)^2)
topdis_6=bottomdis_6+wall_vel_top*1

wall_sumv=0
wall_numwp2=wall_head

;loop while wall_numwp2 # null
;	wall_sumv=wall_sumv + sqrt(w_xvel(wall_numwp2)^2+w_yvel(wall_numwp2)^2+w_zvel(wall_numwp2)^2)
;	wall_numwp2=w_next(wall_numwp2)
;end_loop

;if wall_sumv<1e-12
;	exit
;end_if

pb_broken_num=crk_num

if pb_broken_num>0
			
	wall_numwp=wall_head	
	
	loop while wall_numwp # null
		w_vvel(wall_numwp,1)=0.0;speed of the wall
		w_vvel(wall_numwp,2)=0.0
		w_vvel(wall_numwp,3)=0.0
		wall_numwp=w_next(wall_numwp)
	end_loop
	exit
	
end_if

end_loop

end
